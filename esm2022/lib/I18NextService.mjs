import { Inject, Injectable, Optional } from '@angular/core';
import i18next from 'i18next';
import { I18NEXT_ERROR_HANDLING_STRATEGY, I18NEXT_INSTANCE, } from './I18NEXT_TOKENS';
import { I18NextEvents } from './I18NextEvents';
import * as i0 from "@angular/core";
const i18nextGlobal = i18next;
export class I18NextService {
    errorHandlingStrategy;
    i18next;
    events = new I18NextEvents();
    get language() {
        return this.i18next.language;
    }
    get languages() {
        return this.i18next.languages;
    }
    get options() {
        return this.i18next.options;
    }
    get modules() {
        return this.i18next.modules;
    }
    get services() {
        return this.i18next.services;
    }
    get store() {
        return this.i18next.store;
    }
    get resolvedLanguage() {
        return this.i18next.resolvedLanguage;
    }
    get isInitialized() {
        return this.i18next.isInitialized;
    }
    constructor(errorHandlingStrategy, i18nextInstance) {
        this.errorHandlingStrategy = errorHandlingStrategy;
        this.i18next = i18nextInstance ?? i18nextGlobal;
    }
    t(key, defaultValueOrOptions, options) {
        const hasDefault = !!defaultValueOrOptions && typeof defaultValueOrOptions === 'string';
        this.i18next.t.bind(this.i18next);
        if (hasDefault) {
            return this.i18next.t(key, defaultValueOrOptions, options);
        }
        else {
            return this.i18next.t(key, defaultValueOrOptions);
        }
    }
    use(module) {
        this.i18next.use.call(this.i18next, module);
        return this;
    }
    init(options) {
        this.subscribeEvents();
        return new Promise((resolve, reject) => {
            this.i18next.init.call(this.i18next, Object.assign({}, options ?? {}), this.errorHandlingStrategy.handle(resolve, reject));
        });
    }
    format(value, format, lng) {
        return this.i18next.format.call(this.i18next, value, format, lng, {});
    }
    exists(key, options) {
        return this.i18next.exists.call(this.i18next, key, options);
    }
    getFixedT(lng, ns, keyPrefix) {
        return this.i18next.getFixedT.call(this.i18next, lng, ns, keyPrefix);
    }
    setDefaultNamespace(ns) {
        this.i18next.setDefaultNamespace.call(this.i18next, ns);
    }
    dir(lng) {
        return this.i18next.dir.call(this.i18next, lng);
    }
    changeLanguage(lng) {
        return new Promise((resolve, reject) => {
            return this.i18next.changeLanguage.call(this.i18next, lng, this.errorHandlingStrategy.handle(resolve, reject));
        });
    }
    loadNamespaces(namespaces) {
        return new Promise((resolve, reject) => {
            this.i18next.loadNamespaces.call(this.i18next, namespaces, this.errorHandlingStrategy.handle(resolve, reject));
        });
    }
    loadLanguages(lngs) {
        return new Promise((resolve, reject) => {
            this.i18next.loadLanguages.call(this.i18next, lngs, this.errorHandlingStrategy.handle(resolve, reject));
        });
    }
    //#region resource handling
    loadResources(callback) {
        this.i18next.loadResources.call(this.i18next, callback);
    }
    getDataByLanguage(lng) {
        return this.i18next.getDataByLanguage.call(this.i18next, lng);
    }
    async reloadResources(...params) {
        await this.i18next.reloadResources.apply(this.i18next, params);
    }
    getResource(lng, ns, key, options) {
        return this.i18next.getResource.call(this.i18next, lng, ns, key, options);
    }
    addResource(lng, ns, key, value, options) {
        return this.i18next.addResource.call(this.i18next, lng, ns, key, value, options);
    }
    addResources(lng, ns, resources) {
        return this.i18next.addResources.call(this.i18next, lng, ns, resources);
    }
    addResourceBundle(lng, ns, resources, deep, overwrite) {
        return this.i18next.addResourceBundle.call(this.i18next, lng, ns, resources, deep, overwrite);
    }
    hasResourceBundle(lng, ns) {
        return this.i18next.hasResourceBundle.call(this.i18next, lng, ns);
    }
    getResourceBundle(lng, ns) {
        return this.i18next.getResourceBundle.call(this.i18next, lng, ns);
    }
    removeResourceBundle(lng, ns) {
        return this.i18next.removeResourceBundle.call(this.i18next, lng, ns);
    }
    //#endregion
    subscribeEvents() {
        this.i18next.on.call(this.i18next, 'initialized', (options) => {
            this.events.initialized.next(options);
        });
        this.i18next.on.call(this.i18next, 'loaded', (loaded) => this.events.loaded.next(loaded));
        this.i18next.on.call(this.i18next, 'failedLoading', (lng, ns, msg) => this.events.failedLoading.next({ lng, ns, msg }));
        this.i18next.on.call(this.i18next, 'languageChanged', (lng) => {
            this.events.languageChanged.next(lng);
        });
        this.i18next.on.call(this.i18next, 'missingKey', (lngs, namespace, key, res) => this.events.missingKey.next({ lngs, namespace, key, res }));
        this.i18next.on.call(this.i18next, 'added', (lng, ns) => this.events.added.next({ lng, ns }));
        this.i18next.on.call(this.i18next, 'removed', (lng, ns) => this.events.removed.next({ lng, ns }));
    }
    static ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.0.5", ngImport: i0, type: I18NextService, deps: [{ token: I18NEXT_ERROR_HANDLING_STRATEGY }, { token: I18NEXT_INSTANCE, optional: true }], target: i0.ɵɵFactoryTarget.Injectable });
    static ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "17.0.5", ngImport: i0, type: I18NextService });
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.0.5", ngImport: i0, type: I18NextService, decorators: [{
            type: Injectable
        }], ctorParameters: () => [{ type: undefined, decorators: [{
                    type: Inject,
                    args: [I18NEXT_ERROR_HANDLING_STRATEGY]
                }] }, { type: undefined, decorators: [{
                    type: Optional
                }, {
                    type: Inject,
                    args: [I18NEXT_INSTANCE]
                }] }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSTE4TmV4dFNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvbGliL0kxOE5leHRTZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUM3RCxPQUFPLE9BUU4sTUFBTSxTQUFTLENBQUM7QUFFakIsT0FBTyxFQUNMLCtCQUErQixFQUMvQixnQkFBZ0IsR0FDakIsTUFBTSxrQkFBa0IsQ0FBQztBQUUxQixPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0saUJBQWlCLENBQUM7O0FBUWhELE1BQU0sYUFBYSxHQUFTLE9BQU8sQ0FBQztBQUdwQyxNQUFNLE9BQU8sY0FBYztJQW9DZjtJQW5DTyxPQUFPLENBQU87SUFFL0IsTUFBTSxHQUF1QixJQUFJLGFBQWEsRUFBRSxDQUFDO0lBRWpELElBQUksUUFBUTtRQUNWLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUM7SUFDL0IsQ0FBQztJQUNELElBQUksU0FBUztRQUNYLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUM7SUFDaEMsQ0FBQztJQUVELElBQUksT0FBTztRQUNULE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUM7SUFDOUIsQ0FBQztJQUVELElBQUksT0FBTztRQUNULE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUM7SUFDOUIsQ0FBQztJQUNELElBQUksUUFBUTtRQUNWLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUM7SUFDL0IsQ0FBQztJQUNELElBQUksS0FBSztRQUNQLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUM7SUFDNUIsQ0FBQztJQUVELElBQUksZ0JBQWdCO1FBQ2xCLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQztJQUN2QyxDQUFD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LGNBQWMsa0JBbUNmLCtCQUErQixhQUVuQixnQkFBZ0I7MkdBckMzQixjQUFjOzsyRkFBZCxjQUFjO2tCQUQxQixVQUFVOzswQkFvQ04sTUFBTTsyQkFBQywrQkFBK0I7OzBCQUV0QyxRQUFROzswQkFBSSxNQUFNOzJCQUFDLGdCQUFnQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdCwgSW5qZWN0YWJsZSwgT3B0aW9uYWwgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCBpMThuZXh0LCB7XG4gIERlZmF1bHRUUmV0dXJuLFxuICBJbml0T3B0aW9ucyxcbiAgTW9kdWxlLFxuICBOZXdhYmxlLFxuICBOZXdhYmxlTW9kdWxlLFxuICBURnVuY3Rpb24sXG4gIGkxOG4sXG59IGZyb20gJ2kxOG5leHQnO1xuXG5pbXBvcnQge1xuICBJMThORVhUX0VSUk9SX0hBTkRMSU5HX1NUUkFURUdZLFxuICBJMThORVhUX0lOU1RBTkNFLFxufSBmcm9tICcuL0kxOE5FWFRfVE9LRU5TJztcbmltcG9ydCB7IEkxOE5leHRFcnJvckhhbmRsaW5nU3RyYXRlZ3kgfSBmcm9tICcuL0kxOE5leHRFcnJvckhhbmRsaW5nU3RyYXRlZ2llcyc7XG5pbXBvcnQgeyBJMThOZXh0RXZlbnRzIH0gZnJvbSAnLi9JMThOZXh0RXZlbnRzJztcbmltcG9ydCB7IEkxOE5leHRMb2FkUmVzdWx0IH0gZnJvbSAnLi9JMThOZXh0TG9hZFJlc3VsdCc7XG5pbXBvcnQgeyBJVHJhbnNsYXRpb25FdmVudHMgfSBmcm9tICcuL0lUcmFuc2xhdGlvbkV2ZW50cyc7XG5pbXBvcnQge1xuICBJVHJhbnNsYXRpb25PcHRpb25zLFxuICBJVHJhbnNsYXRpb25TZXJ2aWNlLFxufSBmcm9tICcuL0lUcmFuc2xhdGlvblNlcnZpY2UnO1xuXG5jb25zdCBpMThuZXh0R2xvYmFsOiBpMThuID0gaTE4bmV4dDtcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIEkxOE5leHRTZXJ2aWNlIGltcGxlbWVudHMgSVRyYW5zbGF0aW9uU2VydmljZSB7XG4gIHByaXZhdGUgcmVhZG9ubHkgaTE4bmV4dDogaTE4bjtcblxuICBldmVudHM6IElUcmFuc2xhdGlvbkV2ZW50cyA9IG5ldyBJMThOZXh0RXZlbnRzKCk7XG5cbiAgZ2V0IGxhbmd1YWdlKCkge1xuICAgIHJldHVybiB0aGlzLmkxOG5leHQubGFuZ3VhZ2U7XG4gIH1cbiAgZ2V0IGxhbmd1YWdlcygpIHtcbiAgICByZXR1cm4gdGhpcy5pMThuZXh0Lmxhbmd1YWdlcztcbiAgfVxuXG4gIGdldCBvcHRpb25zKCkge1xuICAgIHJldHVybiB0aGlzLmkxOG5leHQub3B0aW9ucztcbiAgfVxuXG4gIGdldCBtb2R1bGVzKCkge1xuICAgIHJldHVybiB0aGlzLmkxOG5leHQubW9kdWxlcztcbiAgfVxuICBnZXQgc2VydmljZXMoKSB7XG4gICAgcmV0dXJuIHRoaXMuaTE4bmV4dC5zZXJ2aWNlcztcbiAgfVxuICBnZXQgc3RvcmUoKSB7XG4gICAgcmV0dXJuIHRoaXMuaTE4bmV4dC5zdG9yZTtcbiAgfVxuXG4gIGdldCByZXNvbHZlZExhbmd1YWdlKCkge1xuICAgIHJldHVybiB0aGlzLmkxOG5leHQucmVzb2x2ZWRMYW5ndWFnZTtcbiAgfVxuXG4gIGdldCBpc0luaXRpYWxpemVkKCkge1xuICAgIHJldHVybiB0aGlzLmkxOG5leHQuaXNJbml0aWFsaXplZDtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKFxuICAgIEBJbmplY3QoSTE4TkVYVF9FUlJPUl9IQU5ETElOR19TVFJBVEVHWSlcbiAgICBwcml2YXRlIGVycm9ySGFuZGxpbmdTdHJhdGVneTogSTE4TmV4dEVycm9ySGFuZGxpbmdTdHJhdGVneSxcbiAgICBAT3B0aW9uYWwoKSBASW5qZWN0KEkxOE5FWFRfSU5TVEFOQ0UpIGkxOG5leHRJbnN0YW5jZT86IGkxOG4sXG4gICkge1xuICAgIHRoaXMuaTE4bmV4dCA9IGkxOG5leHRJbnN0YW5jZSA/PyBpMThuZXh0R2xvYmFsO1xuICB9XG5cbiAgdChcbiAgICBrZXk6IHN0cmluZyB8IHN0cmluZ1tdLFxuICAgIG9wdGlvbnM/OiBJVHJhbnNsYXRpb25PcHRpb25zIHwgdW5kZWZpbmVkLFxuICApOiBEZWZhdWx0VFJldHVybjxJVHJhbnNsYXRpb25PcHRpb25zPjtcbiAgdChcbiAgICBrZXk6IHN0cmluZyB8IHN0cmluZ1tdIHwgKHN0cmluZyB8IFRlbXBsYXRlU3RyaW5nc0FycmF5KVtdLFxuICAgIGRlZmF1bHRWYWx1ZTogc3RyaW5nLFxuICAgIG9wdGlvbnM/OiBJVHJhbnNsYXRpb25PcHRpb25zIHwgdW5kZWZpbmVkLFxuICApOiBEZWZhdWx0VFJldHVybjxJVHJhbnNsYXRpb25PcHRpb25zPjtcbiAgdChcbiAgICBrZXk6IHVua25vd24sXG4gICAgZGVmYXVsdFZhbHVlT3JPcHRpb25zPzogdW5rbm93bixcbiAgICBvcHRpb25zPzogdW5rbm93bixcbiAgKTogRGVmYXVsdFRSZXR1cm48SVRyYW5zbGF0aW9uT3B0aW9ucz4ge1xuICAgIGNvbnN0IGhhc0RlZmF1bHQgPVxuICAgICAgISFkZWZhdWx0VmFsdWVPck9wdGlvbnMgJiYgdHlwZW9mIGRlZmF1bHRWYWx1ZU9yT3B0aW9ucyA9PT0gJ3N0cmluZyc7XG5cbiAgICB0aGlzLmkxOG5leHQudC5iaW5kKHRoaXMuaTE4bmV4dCk7XG4gICAgaWYgKGhhc0RlZmF1bHQpIHtcbiAgICAgIHJldHVybiB0aGlzLmkxOG5leHQudChcbiAgICAgICAga2V5IGFzIHN0cmluZyB8IHN0cmluZ1tdLFxuICAgICAgICBkZWZhdWx0VmFsdWVPck9wdGlvbnMgYXMgc3RyaW5nLFxuICAgICAgICBvcHRpb25zIGFzIElUcmFuc2xhdGlvbk9wdGlvbnMsXG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdGhpcy5pMThuZXh0LnQoXG4gICAgICAgIGtleSBhcyBzdHJpbmcgfCBzdHJpbmdbXSxcbiAgICAgICAgZGVmYXVsdFZhbHVlT3JPcHRpb25zIGFzIElUcmFuc2xhdGlvbk9wdGlvbnMsXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyB1c2U8VCBleHRlbmRzIE1vZHVsZT4oXG4gICAgbW9kdWxlOiBUIHwgTmV3YWJsZU1vZHVsZTxUPiB8IE5ld2FibGU8VD4sXG4gICk6IElUcmFuc2xhdGlvblNlcnZpY2Uge1xuICAgIHRoaXMuaTE4bmV4dC51c2UuY2FsbCh0aGlzLmkxOG5leHQsIG1vZHVsZSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBpbml0KG9wdGlvbnM6IEluaXRPcHRpb25zKTogUHJvbWlzZTxJMThOZXh0TG9hZFJlc3VsdD4ge1xuICAgIHRoaXMuc3Vic2NyaWJlRXZlbnRzKCk7XG5cbiAgICByZXR1cm4gbmV3IFByb21pc2U8STE4TmV4dExvYWRSZXN1bHQ+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIHRoaXMuaTE4bmV4dC5pbml0LmNhbGwoXG4gICAgICAgIHRoaXMuaTE4bmV4dCxcbiAgICAgICAgT2JqZWN0LmFzc2lnbih7fSwgb3B0aW9ucyA/PyB7fSksXG4gICAgICAgIHRoaXMuZXJyb3JIYW5kbGluZ1N0cmF0ZWd5LmhhbmRsZShyZXNvbHZlLCByZWplY3QpLFxuICAgICAgKTtcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBmb3JtYXQodmFsdWU6IGFueSwgZm9ybWF0Pzogc3RyaW5nLCBsbmc/OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLmkxOG5leHQuZm9ybWF0LmNhbGwodGhpcy5pMThuZXh0LCB2YWx1ZSwgZm9ybWF0LCBsbmcsIHt9KTtcbiAgfVxuXG4gIHB1YmxpYyBleGlzdHMoa2V5OiBzdHJpbmcgfCBzdHJpbmdbXSwgb3B0aW9uczogYW55KSB7XG4gICAgcmV0dXJuIHRoaXMuaTE4bmV4dC5leGlzdHMuY2FsbCh0aGlzLmkxOG5leHQsIGtleSwgb3B0aW9ucyk7XG4gIH1cblxuICBnZXRGaXhlZFQoXG4gICAgbG5nOiBzdHJpbmcgfCByZWFkb25seSBzdHJpbmdbXSxcbiAgICBucz86IHN0cmluZyB8IHJlYWRvbmx5IHN0cmluZ1tdLFxuICAgIGtleVByZWZpeD86IHN0cmluZyxcbiAgKTogVEZ1bmN0aW9uO1xuICBnZXRGaXhlZFQoXG4gICAgbG5nOiBudWxsLFxuICAgIG5zOiBzdHJpbmcgfCByZWFkb25seSBzdHJpbmdbXSB8IG51bGwsXG4gICAga2V5UHJlZml4Pzogc3RyaW5nLFxuICApOiBURnVuY3Rpb247XG4gIGdldEZpeGVkVChsbmc6IGFueSwgbnM/OiBhbnksIGtleVByZWZpeD86IGFueSk6IFRGdW5jdGlvbiB7XG4gICAgcmV0dXJuIHRoaXMuaTE4bmV4dC5nZXRGaXhlZFQuY2FsbCh0aGlzLmkxOG5leHQsIGxuZywgbnMsIGtleVByZWZpeCk7XG4gIH1cblxuICBwdWJsaWMgc2V0RGVmYXVsdE5hbWVzcGFjZShuczogc3RyaW5nKSB7XG4gICAgdGhpcy5pMThuZXh0LnNldERlZmF1bHROYW1lc3BhY2UuY2FsbCh0aGlzLmkxOG5leHQsIG5zKTtcbiAgfVxuXG4gIHB1YmxpYyBkaXIobG5nPzogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuaTE4bmV4dC5kaXIuY2FsbCh0aGlzLmkxOG5leHQsIGxuZyk7XG4gIH1cblxuICBwdWJsaWMgY2hhbmdlTGFuZ3VhZ2UobG5nOiBzdHJpbmcpOiBQcm9taXNlPFRGdW5jdGlvbj4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZTxURnVuY3Rpb24+KFxuICAgICAgKFxuICAgICAgICByZXNvbHZlOiAodGhlbmFibGVPclJlc3VsdDogVEZ1bmN0aW9uIHwgUHJvbWlzZUxpa2U8VEZ1bmN0aW9uPikgPT4gdm9pZCxcbiAgICAgICAgcmVqZWN0OiAoZXJyb3I6IGFueSkgPT4gdm9pZCxcbiAgICAgICkgPT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5pMThuZXh0LmNoYW5nZUxhbmd1YWdlLmNhbGwoXG4gICAgICAgICAgdGhpcy5pMThuZXh0LFxuICAgICAgICAgIGxuZyxcbiAgICAgICAgICB0aGlzLmVycm9ySGFuZGxpbmdTdHJhdGVneS5oYW5kbGUocmVzb2x2ZSwgcmVqZWN0KSxcbiAgICAgICAgKTtcbiAgICAgIH0sXG4gICAgKTtcbiAgfVxuXG4gIHB1YmxpYyBsb2FkTmFtZXNwYWNlcyhuYW1lc3BhY2VzOiBzdHJpbmcgfCBzdHJpbmdbXSk6IFByb21pc2U8YW55PiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlPEkxOE5leHRMb2FkUmVzdWx0PihcbiAgICAgIChcbiAgICAgICAgcmVzb2x2ZTogKFxuICAgICAgICAgIHRoZW5hYmxlT3JSZXN1bHQ6IEkxOE5leHRMb2FkUmVzdWx0IHwgUHJvbWlzZUxpa2U8STE4TmV4dExvYWRSZXN1bHQ+LFxuICAgICAgICApID0+IHZvaWQsXG4gICAgICAgIHJlamVjdDogKGVycm9yOiBhbnkpID0+IHZvaWQsXG4gICAgICApID0+IHtcbiAgICAgICAgdGhpcy5pMThuZXh0LmxvYWROYW1lc3BhY2VzLmNhbGwoXG4gICAgICAgICAgdGhpcy5pMThuZXh0LFxuICAgICAgICAgIG5hbWVzcGFjZXMsXG4gICAgICAgICAgdGhpcy5lcnJvckhhbmRsaW5nU3RyYXRlZ3kuaGFuZGxlKHJlc29sdmUsIHJlamVjdCksXG4gICAgICAgICk7XG4gICAgICB9LFxuICAgICk7XG4gIH1cblxuICBwdWJsaWMgbG9hZExhbmd1YWdlcyhsbmdzOiBzdHJpbmcgfCBzdHJpbmdbXSkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZTx2b2lkPihcbiAgICAgIChcbiAgICAgICAgcmVzb2x2ZTogKHRoZW5hYmxlT3JSZXN1bHQ6IHZvaWQgfCBQcm9taXNlTGlrZTx2b2lkPikgPT4gdm9pZCxcbiAgICAgICAgcmVqZWN0OiAoZXJyb3I6IGFueSkgPT4gdm9pZCxcbiAgICAgICkgPT4ge1xuICAgICAgICB0aGlzLmkxOG5leHQubG9hZExhbmd1YWdlcy5jYWxsKFxuICAgICAgICAgIHRoaXMuaTE4bmV4dCxcbiAgICAgICAgICBsbmdzLFxuICAgICAgICAgIHRoaXMuZXJyb3JIYW5kbGluZ1N0cmF0ZWd5LmhhbmRsZShyZXNvbHZlLCByZWplY3QpLFxuICAgICAgICApO1xuICAgICAgfSxcbiAgICApO1xuICB9XG5cbiAgLy8jcmVnaW9uIHJlc291cmNlIGhhbmRsaW5nXG5cbiAgcHVibGljIGxvYWRSZXNvdXJjZXMoY2FsbGJhY2s/OiAoZXJyOiBhbnkpID0+IHZvaWQpOiB2b2lkIHtcbiAgICB0aGlzLmkxOG5leHQubG9hZFJlc291cmNlcy5jYWxsKHRoaXMuaTE4bmV4dCwgY2FsbGJhY2spO1xuICB9XG4gIHB1YmxpYyBnZXREYXRhQnlMYW5ndWFnZShsbmc6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLmkxOG5leHQuZ2V0RGF0YUJ5TGFuZ3VhZ2UuY2FsbCh0aGlzLmkxOG5leHQsIGxuZyk7XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgcmVsb2FkUmVzb3VyY2VzKC4uLnBhcmFtczogYW55KSB7XG4gICAgYXdhaXQgdGhpcy5pMThuZXh0LnJlbG9hZFJlc291cmNlcy5hcHBseSh0aGlzLmkxOG5leHQsIHBhcmFtcyk7XG4gIH1cblxuICBwdWJsaWMgZ2V0UmVzb3VyY2UobG5nOiBzdHJpbmcsIG5zOiBzdHJpbmcsIGtleTogc3RyaW5nLCBvcHRpb25zOiBhbnkpIHtcbiAgICByZXR1cm4gdGhpcy5pMThuZXh0LmdldFJlc291cmNlLmNhbGwodGhpcy5pMThuZXh0LCBsbmcsIG5zLCBrZXksIG9wdGlvbnMpO1xuICB9XG5cbiAgcHVibGljIGFkZFJlc291cmNlKFxuICAgIGxuZzogc3RyaW5nLFxuICAgIG5zOiBzdHJpbmcsXG4gICAga2V5OiBzdHJpbmcsXG4gICAgdmFsdWU6IGFueSxcbiAgICBvcHRpb25zOiBhbnksXG4gICk6IGkxOG4ge1xuICAgIHJldHVybiB0aGlzLmkxOG5leHQuYWRkUmVzb3VyY2UuY2FsbChcbiAgICAgIHRoaXMuaTE4bmV4dCxcbiAgICAgIGxuZyxcbiAgICAgIG5zLFxuICAgICAga2V5LFxuICAgICAgdmFsdWUsXG4gICAgICBvcHRpb25zLFxuICAgICk7XG4gIH1cblxuICBwdWJsaWMgYWRkUmVzb3VyY2VzKGxuZzogc3RyaW5nLCBuczogc3RyaW5nLCByZXNvdXJjZXM6IGFueSk6IGkxOG4ge1xuICAgIHJldHVybiB0aGlzLmkxOG5leHQuYWRkUmVzb3VyY2VzLmNhbGwodGhpcy5pMThuZXh0LCBsbmcsIG5zLCByZXNvdXJjZXMpO1xuICB9XG5cbiAgcHVibGljIGFkZFJlc291cmNlQnVuZGxlKFxuICAgIGxuZzogc3RyaW5nLFxuICAgIG5zOiBzdHJpbmcsXG4gICAgcmVzb3VyY2VzOiBhbnksXG4gICAgZGVlcDogYW55LFxuICAgIG92ZXJ3cml0ZTogYW55LFxuICApOiBpMThuIHtcbiAgICByZXR1cm4gdGhpcy5pMThuZXh0LmFkZFJlc291cmNlQnVuZGxlLmNhbGwoXG4gICAgICB0aGlzLmkxOG5leHQsXG4gICAgICBsbmcsXG4gICAgICBucyxcbiAgICAgIHJlc291cmNlcyxcbiAgICAgIGRlZXAsXG4gICAgICBvdmVyd3JpdGUsXG4gICAgKTtcbiAgfVxuXG4gIHB1YmxpYyBoYXNSZXNvdXJjZUJ1bmRsZShsbmc6IHN0cmluZywgbnM6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLmkxOG5leHQuaGFzUmVzb3VyY2VCdW5kbGUuY2FsbCh0aGlzLmkxOG5leHQsIGxuZywgbnMpO1xuICB9XG5cbiAgcHVibGljIGdldFJlc291cmNlQnVuZGxlKGxuZzogc3RyaW5nLCBuczogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuaTE4bmV4dC5nZXRSZXNvdXJjZUJ1bmRsZS5jYWxsKHRoaXMuaTE4bmV4dCwgbG5nLCBucyk7XG4gIH1cblxuICBwdWJsaWMgcmVtb3ZlUmVzb3VyY2VCdW5kbGUobG5nOiBzdHJpbmcsIG5zOiBzdHJpbmcpOiBpMThuIHtcbiAgICByZXR1cm4gdGhpcy5pMThuZXh0LnJlbW92ZVJlc291cmNlQnVuZGxlLmNhbGwodGhpcy5pMThuZXh0LCBsbmcsIG5zKTtcbiAgfVxuXG4gIC8vI2VuZHJlZ2lvblxuXG4gIHByaXZhdGUgc3Vic2NyaWJlRXZlbnRzKCkge1xuICAgIHRoaXMuaTE4bmV4dC5vbi5jYWxsKFxuICAgICAgdGhpcy5pMThuZXh0LFxuICAgICAgJ2luaXRpYWxpemVkJyxcbiAgICAgIChvcHRpb25zOiBJbml0T3B0aW9ucykgPT4ge1xuICAgICAgICB0aGlzLmV2ZW50cy5pbml0aWFsaXplZC5uZXh0KG9wdGlvbnMpO1xuICAgICAgfSxcbiAgICApO1xuICAgIHRoaXMuaTE4bmV4dC5vbi5jYWxsKHRoaXMuaTE4bmV4dCwgJ2xvYWRlZCcsIChsb2FkZWQ6IGJvb2xlYW4pID0+XG4gICAgICB0aGlzLmV2ZW50cy5sb2FkZWQubmV4dChsb2FkZWQpLFxuICAgICk7XG4gICAgdGhpcy5pMThuZXh0Lm9uLmNhbGwoXG4gICAgICB0aGlzLmkxOG5leHQsXG4gICAgICAnZmFpbGVkTG9hZGluZycsXG4gICAgICAobG5nOiBzdHJpbmcsIG5zOiBzdHJpbmcsIG1zZzogc3RyaW5nKSA9PlxuICAgICAgICB0aGlzLmV2ZW50cy5mYWlsZWRMb2FkaW5nLm5leHQoeyBsbmcsIG5zLCBtc2cgfSksXG4gICAgKTtcbiAgICB0aGlzLmkxOG5leHQub24uY2FsbCh0aGlzLmkxOG5leHQsICdsYW5ndWFnZUNoYW5nZWQnLCAobG5nOiBzdHJpbmcpID0+IHtcbiAgICAgIHRoaXMuZXZlbnRzLmxhbmd1YWdlQ2hhbmdlZC5uZXh0KGxuZyk7XG4gICAgfSk7XG4gICAgdGhpcy5pMThuZXh0Lm9uLmNhbGwoXG4gICAgICB0aGlzLmkxOG5leHQsXG4gICAgICAnbWlzc2luZ0tleScsXG4gICAgICAobG5nczogc3RyaW5nLCBuYW1lc3BhY2U6IHN0cmluZywga2V5OiBzdHJpbmcsIHJlczogYW55KSA9PlxuICAgICAgICB0aGlzLmV2ZW50cy5taXNzaW5nS2V5Lm5leHQoeyBsbmdzLCBuYW1lc3BhY2UsIGtleSwgcmVzIH0pLFxuICAgICk7XG4gICAgdGhpcy5pMThuZXh0Lm9uLmNhbGwodGhpcy5pMThuZXh0LCAnYWRkZWQnLCAobG5nOiBzdHJpbmcsIG5zOiBzdHJpbmcpID0+XG4gICAgICB0aGlzLmV2ZW50cy5hZGRlZC5uZXh0KHsgbG5nLCBucyB9KSxcbiAgICApO1xuICAgIHRoaXMuaTE4bmV4dC5vbi5jYWxsKHRoaXMuaTE4bmV4dCwgJ3JlbW92ZWQnLCAobG5nOiBzdHJpbmcsIG5zOiBzdHJpbmcpID0+XG4gICAgICB0aGlzLmV2ZW50cy5yZW1vdmVkLm5leHQoeyBsbmcsIG5zIH0pLFxuICAgICk7XG4gIH1cbn1cbiJdfQ==